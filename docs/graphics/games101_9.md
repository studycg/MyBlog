## 如何在三角形内部插值？

有很多操作是在三角形的顶点上，希望在三角形内部有一个平滑的过度。

![image-20260116180847686](./assets/image-20260116180847686.png)

![image-20260116180857799](./assets/image-20260116180857799.png)

## 重心坐标

三角形任何一个点的坐标，都可以表示为三个顶点坐标的线性组合。

![image-20260117062920300](./assets/image-20260117062920300.png)

而且βγ三个系数一定是非负的

![image-20260117063124537](./assets/image-20260117063124537.png)

![image-20260117063152382](./assets/image-20260117063152382.png)

![image-20260117063225996](./assets/image-20260117063225996.png)

如果叉乘的话可以直接得到任意一点中心坐标的公式

![image-20260117063445682](./assets/image-20260117063445682.png)

既然任意一点的重心坐标很好求，那么其它属性也很好插值。

**投影是不能保证重心坐标不变的**

所以光栅化时是不能对投影后的点做插值的。如何把投影到屏幕上的三角形再投影回去呢？逆变换。

# 纹理映射

## 纹理太小了

纹理本身太小，而像素过多。一个pixel可能对应多个texel，而且这个pixel对应的纹理坐标可能是小数。如果取成整数，那么会很难看，因为很多像素被映射到了同一个texel上，会导致相同的颜色。

![image-20260117065915904](./assets/image-20260117065915904.png)

![image-20260117070026750](./assets/image-20260117070026750.png)

![image-20260117070047026](./assets/image-20260117070047026.png)

水平方向的两对点线性插值得到两个点。两个点线性插值得到最终点。
此方法叫**双线性插值**。

bicubic是取周围十六个texel，用的也不是线性插值。所以效果比bilinear好。

## 纹理太大了

在看远处铺满瓷砖的地板。 **1 个屏幕像素可能覆盖了纹理图上 10x10 的区域**。 如果只采样中心那一个点，当移动时，这个点会在 100 个texel里乱跳，导致画面闪烁（摩尔纹），这是一种严重的**走样 (Aliasing)**。

![image-20260117071444330](./assets/image-20260117071444330.png)

![image-20260117071450266](./assets/image-20260117071450266.png)

### 超采样？

一个像素内有很多texel，是一个高频的信号，我们希望用更高频的采样去采集出来。所以一个像素内用很多采样点。但是代价有点大。那不采样行不行？立刻知道这个区域纹理的平均值是多少。

点查询问题和范围查询问题。图像学中查的是范围的平均值。

近的地方覆盖的纹理小，远的地方覆盖的纹理大。

![image-20260117072043172](./assets/image-20260117072043172.png)

### Mipmap

mipmap允许快，不准确，正方形的范围查询。

Allowing (fast, approx., square) range queries

![image-20260117072456232](./assets/image-20260117072456232.png)

一共有lon(n)层

![image-20260117072845579](./assets/image-20260117072845579.png)

那么引入了多少额外存储量呢？

级数求和：1+1/4+1/16+...=1/3

 或者用每一份图复制三份，用极限理解。

![image-20260117073614142](./assets/image-20260117073614142.png)

![](./assets/image-20260117073630958.png)

L：找纹理上相邻像素点最长的边。当然把像素方块的四个顶点映射到纹理坐标中求最长的边也是可以的。

那查询哪一层的图像呢？边长L的区域平均值是多少？去$$log_2L$$层。

但是离散的若干层渐变仿佛**不连续**

那么怎么做中间层的纹理呢？**插值！**

![image-20260117074421896](./assets/image-20260117074421896.png)

这就是三线性插值。

![image-20260117075124116](./assets/image-20260117075124116.png)

![image-20260117075130012](./assets/image-20260117075130012.png)

可见三线性插值变连续了。

### 各向异性过滤

三线性插值本身也是近似的
Mipmap只是正方形区域内的区间搜索

如何接近？**各向异性过滤**

Mipmap不会对不同的长宽比做预计算。

![image-20260117075750579](./assets/image-20260117075750579.png)

![image-20260117075907500](./assets/image-20260117075907500.png)

各向异性过滤对于矩形的查询更好，但是对于这种斜着的，也没办法。

各向异性过滤开销是原来的三倍。

各向异性为什么叫这个名字呢：在不同的方向上表现各不相同。

2x就是方向上压缩了一次，计算了2层。开多少x基本都是3倍速。对显存要求高。

### EWA

用圆形包裹多次查询。

![image-20260117080256335](./assets/image-20260117080256335.png)